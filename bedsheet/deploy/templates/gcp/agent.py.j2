"""
{{ agent.name }} - ADK Agent
Generated by: bedsheet deploy --target gcp
{% if agent.description %}
{{ agent.description }}
{% endif %}
"""
from google.adk.agents import LlmAgent{% if orchestration != "single" %}, SequentialAgent{% endif %}

{% if gcp.builtin_tools %}
# ADK Built-in tools
{% if 'google_search' in gcp.builtin_tools and agent.tools %}
# Use GoogleSearchTool with bypass_multi_tools_limit to mix with custom tools
from google.adk.tools.google_search_tool import GoogleSearchTool
{% for tool in gcp.builtin_tools if tool != 'google_search' %}
from google.adk.tools import {{ tool }}
{% endfor %}
{% else %}
from google.adk.tools import {{ gcp.builtin_tools | join(', ') }}
{% endif %}
{% endif %}

{% if all_imports %}
# Imports (collected from all tools)
{% for imp in all_imports %}
{{ imp }}
{% endfor %}
{% endif %}

{% if all_module_constants %}
# Module-level constants (collected from all tools)
{% for const in all_module_constants %}
{{ const }}
{% endfor %}
{% endif %}

{% if agent.tools %}
# Tool definitions for {{ agent.name }} (converted from Bedsheet @action decorators)
{% for tool in agent.tools %}
{{ tool.source_code }}

{% endfor %}
{% endif %}

{% if agent.collaborators %}
# Tool definitions for collaborator agents
{% for collab in agent.collaborators %}
{% if collab.tools %}
# Tools for {{ collab.name }}
{% for tool in collab.tools %}
{{ tool.source_code }}

{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

# Agent definition
{% if orchestration == "single" %}
root_agent = LlmAgent(
    name="{{ agent.name | replace('-', '_') }}",
    model="{{ gcp.model or 'gemini-2.0-flash-001' }}",
    instruction="""{{ agent.instruction | replace('"""', '\\"\\"\\"') }}""",
    {% if agent.tools or gcp.builtin_tools %}
    tools=[
        {%- for tool in agent.tools %}{{ tool.name }}, {% endfor %}
        {%- if 'google_search' in gcp.builtin_tools and agent.tools %}GoogleSearchTool(bypass_multi_tools_limit=True), {% endif %}
        {%- for builtin in gcp.builtin_tools if builtin != 'google_search' or not agent.tools %}{{ builtin }}, {% endfor %}
    ],
    {% endif %}
)
{% else %}
# Collaborator agents
{% for collab in agent.collaborators %}
{{ collab.name | replace('-', '_') }}_agent = LlmAgent(
    name="{{ collab.name | replace('-', '_') }}",
    model="{{ gcp.model or 'gemini-2.0-flash-001' }}",
    instruction="""{{ collab.instruction | replace('"""', '\\"\\"\\"') }}""",
    {% if collab.tools or gcp.builtin_tools %}
    tools=[
        {%- for tool in collab.tools %}{{ tool.name }}, {% endfor %}
        {%- if 'google_search' in gcp.builtin_tools and collab.tools %}GoogleSearchTool(bypass_multi_tools_limit=True), {% endif %}
        {%- for builtin in gcp.builtin_tools if builtin != 'google_search' or not collab.tools %}{{ builtin }}, {% endfor %}
    ],
    {% endif %}
)

{% endfor %}

{% if agent.tools %}
# Parallel sub-agents sweep
_parallel_sweep = SequentialAgent(
    name="{{ project_name }}_parallel_sweep",
    sub_agents=[{% for collab in agent.collaborators %}{{ collab.name | replace('-', '_') }}_agent{% if not loop.last %}, {% endif %}{% endfor %}],
)

# Supervisor (orchestrates sweep then acts on results)
root_agent = LlmAgent(
    name="{{ agent.name | replace('-', '_') }}",
    model="{{ gcp.model or 'gemini-2.0-flash-001' }}",
    instruction="""{{ agent.instruction | replace('"""', '\\"\\"\\"') }}""",
    tools=[{% for tool in agent.tools %}{{ tool.name }}, {% endfor %}],
    sub_agents=[_parallel_sweep],
)
{% else %}
# Orchestrator (parallel)
root_agent = SequentialAgent(
    name="{{ agent.name | replace('-', '_') }}",
    sub_agents=[{% for collab in agent.collaborators %}{{ collab.name | replace('-', '_') }}_agent{% if not loop.last %}, {% endif %}{% endfor %}],
)
{% endif %}
{% endif %}
