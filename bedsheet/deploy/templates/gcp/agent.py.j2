"""
{{ agent.name }} - ADK Agent
Generated by: bedsheet deploy --target gcp
{% if agent.description %}
{{ agent.description }}
{% endif %}
"""
from google.adk.agents import LlmAgent{% if orchestration != "single" %}, {{ orchestration.title() }}Agent{% endif %}

{% if gcp.builtin_tools %}
# ADK Built-in tools
{% if 'google_search' in gcp.builtin_tools and agent.tools %}
# Use GoogleSearchTool with bypass_multi_tools_limit to mix with custom tools
from google.adk.tools.google_search_tool import GoogleSearchTool
{% for tool in gcp.builtin_tools if tool != 'google_search' %}
from google.adk.tools import {{ tool }}
{% endfor %}
{% else %}
from google.adk.tools import {{ gcp.builtin_tools | join(', ') }}
{% endif %}
{% endif %}

{% if agent.tools %}
# Tool definitions for {{ agent.name }} (converted from Bedsheet @action decorators)
{% for tool in agent.tools %}
{% for imp in tool.imports %}
{{ imp }}
{% endfor %}

{{ tool.source_code }}

{% endfor %}
{% endif %}

{% if agent.collaborators %}
# Tool definitions for collaborator agents
{% for collab in agent.collaborators %}
{% if collab.tools %}
# Tools for {{ collab.name }}
{% for tool in collab.tools %}
{% for imp in tool.imports %}
{{ imp }}
{% endfor %}

{{ tool.source_code }}

{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

# Agent definition
{% if orchestration == "single" %}
root_agent = LlmAgent(
    name="{{ agent.name }}",
    model="{{ gcp.model or 'gemini-2.0-flash-001' }}",
    instruction="""{{ agent.instruction | replace('"""', '\\"\\"\\"') }}""",
    {% if agent.tools or gcp.builtin_tools %}
    tools=[
        {%- for tool in agent.tools %}{{ tool.name }}, {% endfor %}
        {%- if 'google_search' in gcp.builtin_tools and agent.tools %}GoogleSearchTool(bypass_multi_tools_limit=True), {% endif %}
        {%- for builtin in gcp.builtin_tools if builtin != 'google_search' or not agent.tools %}{{ builtin }}, {% endfor %}
    ],
    {% endif %}
)
{% else %}
# Collaborator agents
{% for collab in agent.collaborators %}
{{ collab.name | replace('-', '_') }}_agent = LlmAgent(
    name="{{ collab.name }}",
    model="{{ gcp.model or 'gemini-2.0-flash-001' }}",
    instruction="""{{ collab.instruction | replace('"""', '\\"\\"\\"') }}""",
    {% if collab.tools or gcp.builtin_tools %}
    tools=[
        {%- for tool in collab.tools %}{{ tool.name }}, {% endfor %}
        {%- if 'google_search' in gcp.builtin_tools and collab.tools %}GoogleSearchTool(bypass_multi_tools_limit=True), {% endif %}
        {%- for builtin in gcp.builtin_tools if builtin != 'google_search' or not collab.tools %}{{ builtin }}, {% endfor %}
    ],
    {% endif %}
)

{% endfor %}

# Orchestrator ({{ orchestration }})
root_agent = {{ orchestration.title() }}Agent(
    name="{{ agent.name }}",
    sub_agents=[{% for collab in agent.collaborators %}{{ collab.name | replace('-', '_') }}_agent{% if not loop.last %}, {% endif %}{% endfor %}],
)
{% endif %}
