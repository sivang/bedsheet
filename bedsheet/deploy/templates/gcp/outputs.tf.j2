# {{ config.name }} - Terraform Outputs
# Generated by: bedsheet deploy --target gcp
#
# These outputs provide essential information after deployment.

# =============================================================================
# SERVICE ENDPOINTS
# =============================================================================

output "service_url" {
  description = "URL of the deployed Cloud Run service"
  value       = google_cloud_run_v2_service.agent.uri
}

output "invoke_url" {
  description = "URL to invoke the agent API"
  value       = "${google_cloud_run_v2_service.agent.uri}/invoke"
}

output "health_url" {
  description = "URL to check agent health"
  value       = "${google_cloud_run_v2_service.agent.uri}/health"
}

# =============================================================================
# RESOURCE IDENTIFIERS
# =============================================================================

output "service_name" {
  description = "Name of the Cloud Run service"
  value       = google_cloud_run_v2_service.agent.name
}

output "project_id" {
  description = "GCP Project ID"
  value       = var.project_id
}

output "region" {
  description = "Deployment region"
  value       = var.region
}

output "environment" {
  description = "Deployment environment"
  value       = var.environment
}

# =============================================================================
# SERVICE ACCOUNT
# =============================================================================

output "service_account_email" {
  description = "Service account email for the agent"
  value       = google_service_account.agent.email
}

output "service_account_id" {
  description = "Service account unique ID"
  value       = google_service_account.agent.unique_id
}

# =============================================================================
# CONTAINER REGISTRY
# =============================================================================

output "artifact_registry_url" {
  description = "URL for pushing container images"
  value       = "${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.agent_repo.repository_id}"
}

output "container_image" {
  description = "Full container image path"
  value       = "${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.agent_repo.repository_id}/{{ project_name | replace('_', '-') }}:${var.image_tag}"
}

# =============================================================================
# OBSERVABILITY & MONITORING
# =============================================================================

output "logs_url" {
  description = "URL to view Cloud Run logs in Google Cloud Console"
  value       = "https://console.cloud.google.com/logs/query;query=resource.type%3D%22cloud_run_revision%22%20resource.labels.service_name%3D%22{{ project_name | replace('_', '-') }}%22?project=${var.project_id}"
}

output "monitoring_url" {
  description = "URL to Cloud Monitoring dashboard"
  value       = "https://console.cloud.google.com/monitoring?project=${var.project_id}"
}

output "cloud_run_console_url" {
  description = "URL to Cloud Run service in Google Cloud Console"
  value       = "https://console.cloud.google.com/run/detail/${var.region}/{{ project_name | replace('_', '-') }}?project=${var.project_id}"
}

# =============================================================================
# QUICK TEST COMMANDS
# =============================================================================

output "test_command" {
  description = "Command to test the deployed agent"
  value       = <<-EOT
    curl -X POST ${google_cloud_run_v2_service.agent.uri}/invoke \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer $(gcloud auth print-identity-token)" \
      -d '{"message": "Hello!"}'
  EOT
}

output "logs_command" {
  description = "Command to stream logs"
  value       = "gcloud run logs tail {{ project_name | replace('_', '-') }} --region ${var.region} --project ${var.project_id}"
}
