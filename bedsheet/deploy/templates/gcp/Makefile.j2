# {{ config.name }} - GCP Deployment
# Generated by: bedsheet deploy --target gcp

.PHONY: help setup test build deploy deploy-terraform logs clean tf-init tf-plan tf-apply tf-destroy

PROJECT = {{ gcp.project or 'YOUR_PROJECT_ID' }}
REGION = {{ gcp.region or 'us-central1' }}
SERVICE = {{ project_name }}

help:
	@echo "{{ config.name }} - GCP Deployment"
	@echo ""
	@echo "Commands:"
	@echo "  make setup          - Install dependencies"
	@echo "  make test           - Test agent locally with ADK"
	@echo "  make build          - Build container image"
	@echo "  make deploy         - Deploy via Cloud Build (quick)"
	@echo "  make deploy-terraform - Deploy via Terraform (full IaC)"
	@echo "  make logs           - View Cloud Run logs"
	@echo "  make clean          - Clean build artifacts"
	@echo ""
	@echo "Terraform Commands:"
	@echo "  make tf-init        - Initialize Terraform"
	@echo "  make tf-plan        - Plan infrastructure changes"
	@echo "  make tf-apply       - Apply infrastructure changes"
	@echo "  make tf-destroy     - Destroy infrastructure"

setup:
	pip install -r requirements.txt

test:
	python -m google.adk.cli run agent.agent

build:
	docker build -t gcr.io/$(PROJECT)/$(SERVICE):latest .

# Quick deploy via Cloud Build (uses gcloud, no state management)
deploy:
	gcloud builds submit --config cloudbuild.yaml --project $(PROJECT)

# Full IaC deploy via Terraform (recommended for production)
deploy-terraform: tf-init tf-apply

logs:
	gcloud run logs read $(SERVICE) --region $(REGION) --project $(PROJECT)

clean:
	rm -rf __pycache__ agent/__pycache__ terraform/.terraform

# Terraform commands
tf-init:
	cd terraform && terraform init

tf-plan:
	cd terraform && terraform plan

tf-apply:
	cd terraform && terraform apply

tf-destroy:
	cd terraform && terraform destroy
